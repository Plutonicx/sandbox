<html>
<head>
    <link href="static/content/bootstrap.min.css" rel="stylesheet" type="text/css" />


    <script src="static/scripts/jquery-1.8.3.min.js"></script>
    <script src="static/scripts/bootstrap-typeahead.js"></script>
    <script src="static/scripts/underscore-min.js"></script>

    <script>

        



    var new_products = null;

    function ajaxCallBack(product_obj) {
        new_products = product_obj;
    }

    $(document).ready(function ($) {

        // on clicking star rating.
        $('#rating-input-1-4').click(function () {
            //Some code
            alert("4!");
            // thid.id to get id of current element.
            // will post and redirect url as temporary solution.
        });

        // Workaround for bug in mouse item selection
        $.fn.typeahead.Constructor.prototype.blur = function () {
            var that = this;
            setTimeout(function () { that.hide() }, 250);
        };

        var that = this;

        $('#product_search').typeahead({
            source: function (query, process) {
                $('#product').hide();

                $(function () {
                    $.ajax({
                        url: '{{ url_for("typeAhead") }}',
                        type: 'POST',
                        success: function (result) {
                            ajaxCallBack(JSON.parse(result));
                            //console.log(result);
                        }
                    });
                });

                var results = _.map(new_products, function (product) {
                    return product.name;
                });
                process(results);
            },

            //matcher: function(item) {
            //    return true;
            //},

            highlighter: function (name) {
                var product = _.find(new_products, function (p) {
                    return p.name == name;
                });

                html = '<div class="typeahead">';
                html += '<div class="media"><a class="pull-left" href="#"><img src=' + product.imgurl + ' /></a>'
                html += '<div class="media-body">';
                html += '<p class="media-heading">' + product.name + ' ($' + product.price + ')' + '</p>';
                html += '</div>';
                html += '</div>';

                //return product.name + " ($" + product.price + ")";
                return html;
            },

            updater: function (name) {
                var product = _.find(new_products, function (p) {
                    return p.name == name;
                });
                that.setSelectedProduct(product);
                return product.name;
            }

        });

        $('#product').hide();
        this.setSelectedProduct = function (product) {
            $('#product').html("Purchase: <strong>" + product.name + " ($" + product.price + ")</strong>").show();
        }
    });



    </script>
    <style>
        .rating {
            overflow: hidden;
            display: inline-block;
            font-size: 0;
            position: relative;
        }
        .rating-input {
            float: right;
            width: 24px;
            height: 24px;
            padding: 0;
            margin: 0 0 0 -24px;
            opacity: 0;
        }
        .rating:hover .rating-star:hover,
        .rating:hover .rating-star:hover ~ .rating-star,
        .rating-input:checked ~ .rating-star {
            background-position: 0 0;
        }
        .rating-star,
        .rating:hover .rating-star {
            position: relative;
            float: right;
            display: block;
            width: 24px;
            height: 24px;
            background: url('../static/content/Images/star_med.png') 0 -24px;
        }

        /* Just for the demo */
        body {
            margin: 20px;
        }
</style>
    
</head>
<body>

    <div style="margin: 50px 50px">
        <label for="product_search">Product Search: </label>
        <input id="product_search" type="text" data-provide="typeahead">
    </div>


    <div id="rating_stars_dynamic">
        <span class="rating" id="rating_dynamic">

            </span>
    </div>



            <script>

                function function1(num, el) {
                    var span = document.getElementById("rating_dynamic");
                    var input = document.createElement("input");
                    input.setAttribute("type", "radio");
                    input.setAttribute("class", "rating-input");
                    input.setAttribute("id", "rating-input-"+num+"-5_dynamic");
                    input.setAttribute("name", "rating-input-"+el+"_dynamic");
                    input.onclick = function () {
                        alert("hello world");
                    };

                    var label = document.createElement("label");
                    label.setAttribute("for", "rating-input-"+num+"-5_dynamic");
                    label.setAttribute("class", "rating-star");

                    span.appendChild(input);
                    span.appendChild(label);
                    //alert(input.id);
                };

                function1("1","1");
                function1("2","1");
                function1("3","1");
                function1("4","1");
                function1("5","1");

            </script>

            <div id="rating_stars">
                <span class="rating">
                    <input type="radio" class="rating-input"
                           id="rating-input-1-5" name="rating-input-1">
                    <label for="rating-input-1-5" class="rating-star"></label>
                    <input type="radio" class="rating-input"
                           id="rating-input-1-4" name="rating-input-1">
                    <label for="rating-input-1-4" class="rating-star"></label>
                    <input type="radio" class="rating-input"
                           id="rating-input-1-3" name="rating-input-1">
                    <label for="rating-input-1-3" class="rating-star"></label>
                    <input type="radio" class="rating-input"
                           id="rating-input-1-2" name="rating-input-1">
                    <label for="rating-input-1-2" class="rating-star"></label>
                    <input type="radio" class="rating-input"
                           id="rating-input-1-1" name="rating-input-1">
                    <label for="rating-input-1-1" class="rating-star"></label>
                </span>
            </div>

</body>
</html>